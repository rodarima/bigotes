.Dd Apr 18, 2024
.Dt BIGOTES 1
.Os
.Sh NAME
.Nm bigotes
.Nd benchmark measurement tool
.Sh SYNOPSIS
.Nm bigotes
.Op Ar options
.Op Fl -
.Ar command
.Op Ar args...
.Nm bigotes
.Op Ar options
.Fl s Ar script
.Nm bigotes
.Op Ar options
.Fl i
.Sh DESCRIPTION
The
.Nm
program is a versatile tool designed to perform automatic benchmark
measurements and report statistical information. A single quantity is
sampled multiple times by either running again a given program or by
reading the values from the standard input. The typical quantity 
is the execution time, but others can be used too.
.Pp
The execution of the program is repeated until at least 30 samples are
collected, 30 seconds have elapsed and the Standard Error of the Mean
(SEM) is small.
All those criteria must be met to stop collecting samples.
.Pp
At the end, a summary is shown with the number of samples collected
(RUN), the execution time (WALL), the five-number summary (MIN, Q1,
MEDIAN, Q3, MAX), the median average deviation (MAD), the relative MAD
to the median (%MAD) and the relative standard error of the mean (%SEM).
An histogram is plotted by using UTF-8 block characters and the results
of the Shapiro-Wilk test for normality.
.Pp
There are three modes of operation and one must be selected.
.Bl -tag -width Ds
.It Fl -
Selects the
.Em exec
mode (the default). Runs the command and arguments as-is, without a shell. The 
.Fl -
flag may be omitted.
.It Fl s
Selects the
.Em shell
mode. Runs the
.Ar script
in a shell, performing the shell substitution as
necessary. Allows processing the output with a pipe, but requires
escaping quotes.
.It Fl i
Selects the
.Em stdin
mode. Reads quantities values from the standard input, one per line.
Nothing is executed in this mode.
.El
.Pp
The
.Ar options
must precede the operation mode and are as follows:
.Bl -tag -width Ds
.It Fl o Ar file
Write the measured quantities in the given
.Ar file ,
one per line. Not compatible with the stdin mode.
.It Fl q
Be quiet, don't report progress information during execution.
.It Fl w
Instead of reading the quantity from the standard output, use the
wall clock time (in seconds) that the program took to run. Not
compatible with the stdin mode.
.It Fl X
Remove outliers from the stopping criteria and histogram. The summary
statistics always use all samples.
.El
.Pp
The name
.Nm
comes from the Spanish word for whiskers which are commonly used in
statistics to represent the dispersion of a sample when drawing box
plots or error bars.
.Sh EXIT STATUS 
.Ex -std
.Sh EXAMPLES
.Bl -enum -compact -width w
.It
Measure the wall clock time taken by a command:
.Bd -literal -offset xx
$ bigotes -w find ~/pic -iname '*.jpg'

       Min         Q1     Median       Mean         Q3        Max
 2.767e-02  2.818e-02  2.835e-02  2.849e-02  2.860e-02  3.962e-02
         N   Outliers   1.48*MAD      Stdev   Skewness   Kurtosis
      1054         26  2.921e-04  6.137e-04  7.551e+00  1.118e+02

    Shapiro-Wilk: W=5.92e-01, p-value=3.37e-44 (NOT normal)

   ▁█
   ██▂
  ▁███▂
 ▁█████▆▃▁▁▁▁▁▁▁▁▁ ▁           ▁  ▁                             ▁

.Ed
.It
Run a benchmark in a remote machine by using srun and use the value
written in the standard output as measured quantity:
.Bd -literal -offset xx
$ srun -u -c56 bigotes b6_heat_nanos6 -s 2048 -t 10 -b 64

 Min         Q1     Median       Mean         Q3        Max
 3.057e-02  3.356e-02  3.897e-02  3.727e-02  3.962e-02  4.298e-02
         N   Outliers   1.48*MAD      Stdev   Skewness   Kurtosis
       313          0  2.115e-03  3.370e-03 -5.843e-01 -1.228e+00

    Shapiro-Wilk: W=8.53e-01, p-value=1.30e-16 (NOT normal)
    Dip test:     D=6.91e-02, p-value=nan (may be unimodal)

                                            █
                                            █▆▄
     ▁▆       ▄                            ▇████ ▅
 ▁▁ ▂██▆▄▇▃▄▃▄█▅▇▅▃▃▃▂▁▁▂ ▁▃▂▁▂     ▁▁▂▂▃▆████████▅█▇▃██▁▄▃▅    ▁

.Ed
.It
Ping a remote host and take the time as the measurement using a pipe
(note the escaping for the shell):
.Bd -literal -offset xx
$ bigotes -s "ping -c 1 1.1.1.1 | awk -F/ 'END {print \$5}'"

       Min         Q1     Median       Mean         Q3        Max
 1.697e+01  1.862e+01  1.921e+01  1.922e+01  1.962e+01  3.920e+01
         N   Outliers   1.48*MAD      Stdev   Skewness   Kurtosis
       988         14  7.183e-01  1.181e+00  6.162e+00  8.791e+01

    Shapiro-Wilk: W=6.94e-01, p-value=6.50e-39 (NOT normal)
    Dip test:     D=8.95e-03, p-value=9.00e-01 (may be unimodal)

      ▄█▇
     ▄███
   ▂▅████▆▂
 ▁▄████████▄▁▁▁▁ ▁▁▁▁   ▁▁       ▁                              ▁

.Ed
.It
Read the measurements from the standard input, generated by a Gaussian
distribution using the gsl-randist tool:
.Bd -literal -offset xx
% gsl-randist 0 5000 gaussian 0.5 | bigotes -i

       Min         Q1     Median       Mean         Q3        Max
-1.736e+00 -3.227e-01  4.732e-03  1.135e-02  3.481e-01  1.669e+00
         N   Outliers   1.48*MAD      Stdev   Skewness   Kurtosis
      5000          0  4.986e-01  4.985e-01 -5.619e-03 -5.210e-02

    Shapiro-Wilk: W=1.00e+00, p-value=7.00e-01 (may be normal)
    Dip test:     D=2.45e-03, p-value=1.00e+00 (may be unimodal)

                           ▂  ▆▆█▅▅▇▂▁▁▂▁
                        ▁▄▂█▇▇███████████▅ ▁
                  ▁▁▁▆▆███████████████████▇█▇▄▃▃▁▁
 ▁ ▁▁▁▁▁▁▁▁▂▂▃▂▄▄▆████████████████████████████████▆▅▃▄▂▁▁▁▁▁▁▁▁▁▁

.Ed

.Sh SEE ALSO
.Pp
The repository 
.Lk https://github.com/rodarima/bigotes/
contains the last version of the program.
.Sh AUTHORS
.An "Rodrigo Arias Mallo" Aq Mt "rodrigo.arias@bsc.es"
